#!/bin/bash
if [ $DISPLAY ]; then
	if ( ! xprop -root | grep KDE > /dev/null ); then
		echo "MAKEBLUR: window type not KDE, cannot run."; false
	else
		function func_getcurrentwindow()
		{
			if (tty -s); then
				getspec="-root"
			else
				getspec=
			fi
			xprop $getspec | grep ^"_NET_ACTIVE_WINDOW" | grep --only-matching "0x[0-9a-fA-F]*" --color=never			
		}
		
		xprop  -f _KDE_NET_WM_BLUR_BEHIND_REGION 32c -set _KDE_NET_WM_BLUR_BEHIND_REGION 0 -id `func_getcurrentwindow`
		RETVAL=$[ $? + 0 ]
		# just in case we were sourced, undefine the function
		unset func_getcurrentwindow
		if [ $RETVAL -eq 0 ]; then
			# in the case that we are not sourced and can't use "return" then we must
			# just set the return value to 1 this way to avoid errors (same with the false case above/below)
			true
		else
			echo -ne "MAKEBLUR: "
			if [ $RETVAL -eq 1 ]; then
				echo "Something went wrong when setting the window attributes, general failure."
			else
				echo "Attribute Setting Failed, Got Extended Error Code # $RETVAL (but returning 1)."
			fi
			false
		fi
	fi
fi
