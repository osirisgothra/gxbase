#!/bin/bash
#
# goo
#      google quick search
# (C)2012-14 Gabriel Sharp, T <osirisgothra@hotmail.com>
# http://paradisim.tk
#

function _running() 
{	
	grep -u $USERNAME "$*";	return $?; 
}

function _getkey() 
{
	unset REPLY
	until [[ $REPLY =~ [$1] ]]; do read -sn1; done
	if [[ $# -eq 1 ]]; then
		echo $REPLY
	elif [[ $2 == u ]]; then
		echo ${REPLY^^}
	elif [[ $2 == l ]]; then
		echo ${REPLY,,}
	else
		echo ${REPLY${2}}
	fi
}

BROWSER=""
SITENAME='www.google.com'
SEARCHPREFIX='/search?q='
SEARCHSUFFIX=''
SEARCHSITE="http://${SITENAME}${SEARCHPREFIX}"
SEARCHSITE_NOSEARCH="http://${SITENAME}"
WORDS=$(printf "%s+" "$@")
SEARCHLINE="${SEARCHSITE}${WORDS}${SEARCHSUFFIX}"
if TTY=$(tty) && [[ $TTY =~ .*pts.* ]]; then
	echo "Executing in Background, Disowned"
	EXESUFF="& disown"
else
	# tty is NULL or is /dev/ttyXXX
	echo "Executing in Foreground, Waiting"
	EXESUFF=""
fi

if [[ $EXESUFF ]] && [[ $DISPLAY ]]; then
	if [[ $SSH_TTY == $TTY ]]; then
		echo "Running in Remote Mode, Still Use GUI? [Y:/n]"
		if [[ $(getkey yn u) == N ]]; then
			CANCELGUI=1
		else
			unset CANCELGUI
		fi
	fi
	if [[ -z $CANCELGUI ]]; then		
	
		if _running firefox; then
			BROWSER=(`which firefox` "-new-tab")
		elif _running chromium-browser; then
			BROWSER=`which chromium-browser`
		elif _running google-chrome; then
			BROWSER=`which google-chrome`
		elif _running rekonq; then
			BROWSER=`which rekonq`
		elif _running midori; then
			BROWSER=`which midori`
		elif _running konqueror; then
			BROWSER=`which konqueror`
		fi
	fi
fi
[[ -z $BROWSER ]] && BROWSER=("/usr/bin/links2" "-g")
"${BROWSER[@]}" $SEARCHLINE $EXESUFF


