#!/bin/bash
#
# apt-sudo
#
# delegate for running apt- commands via sudo
#
# This is a multi-call script, if you want to sudoize an apt-command, please 
#  make a symbolic link to this file (example: ln -s /$PWD/apt-sudo aot-get) 
#

# Protect interactive shell's environment by forcing an execution rather
# than allowing this file to be sourced. [system.security]
case $- in *i*) eval $BASH_SOURCE "$@"; return $?;; esac


case $UID in
0)
#	OLDPATH=$PATH
 # PATH=/usr/bin:/usr/sbin:/bin:/sbin:/lib/lsb
 # hash -r
 # if type -a "$(basename $1)"; then
 # 	eval "$@"
 # 	exit $?
 # fi
  NOQUOTE=YES
 # PATH=$OLDPATH
	;;
esac



# since security measures taken, $0 will be the script's name always
set ${GX_DEBUGMODE-+x}
BASENAME=$(basename $0)
set +x
unset HUSH
case $BASENAME in 
	apt-sudo)
		case $1 in
			hush)
				if [[ -z $2 ]]; then
					echo "second param must be apt or dpkg"
					exit 2
				elif [[ $2 != dpkg ]] && [[ $2 != apt ]]; then
					echo "$2: bad hush target! use dpkg or apt!"
					exit 2
				fi
				if [[ $3 == off ]]; then
					echo "hushmode $2 off"
					rm ~/.hush$2 -f
				else
					echo "hushmode on (use hush $2 off to turn off)"
					touch ~/.hush$2
				fi
				exit 0
				;;
			*)
				echo "Error: please make symbolic links of your favorite apt- commands or dpkg-"
				echo "       commands you wish to sudoize first, link them to this script in a"
				echo "       separate directory than the originals, make sure they are added to"
				echo "       the path BEFORE your /usr/bin/apt* or dpkg* commands."
				echo "       Alternately you can hash them in yourself using bash's [1mhash[0m command."
				;;
		esac		
		exit 1
		;;
	dpkg|dpkg-*)
		[[ ! -r ~/.hushdpkg ]] && [[ -z $NOQUOTE ]] && echo "Launching DPKG (debian package) command with sudo..." || HUSH=1 ;;&
	apt-*)
		[[ ! -r ~/.hushapt ]] && [[ -z $NOQUOTE ]] && echo "Launching APT command with sudo..." || HUSH=1 ;;&
	dpkg|apt-*|dpkg-*)
		eval sudo "$BASENAME" "$@"
		ERR=$?
		[[ -z $HUSH ]] && echo "APT Command Returned With Value: [1m$ERR[0m"
		exit $ERR;;
	*)
		echo "Invalid filename [1m$BASENAME[0m, you can only use this command for apt- and dpkg- commands!"
		exit 2;;
esac
echo "Internal Error: $BASENAME, $*, $ERR - Notify the author if failure persists."
exit 254



