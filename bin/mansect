#!/bin/bash
case $- in *i*) $BASH_SOURCE "$@"; return $?;; esac
TGT=$(basename $0)
SEC=${TGT#man}
if /usr/bin/man --section $SEC "$@"; then
	true;
else
  if [[ "$*" =~ .*[^-]-[a-z]*k.* ]]; then
		echo "Keyword matchup failed, please try again"
	else
		echo "Exited with failure, retrying against query:"	
		if /usr/bin/man --section $SEC -k "$@" | tee results; then
			echo "Enter a selection [q = quit]"
			select ITEM in `cat results | grep -Po '^[^ ]*'`; do
				if [[ $REPLY == q ]]; then
					exit 1
				elif [[ $REPLY -gt 0 ]]; then
					/usr/bin/man --section $SEC $ITEM
				fi
				echo "Enter a selection [q = quit]"
			done
		else
    	echo "Refined to search but $* does not match anything, please try a different or less specific term"
		fi
	fi
fi
exit $?
