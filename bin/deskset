#!/bin/bash
#
#
# kdeskset    
#
# 	Configure KDE's desktop, window, workspace and other visual settings.
# 
# Author:
#      Gabriel Sharp <gabriel@paradisim.tk>
#
# Copyright (c) 2013 Paradisim Enterprises, LLC
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#
#
function kcmopts()
{
	echo '--icon /usr/share/icons/hicolor/16x16/devices/totem-tv.png --style QtCurve --geometry 800x600' 
}
function shellnames()
{
	
	printf colors" "
	printf cursortheme" "
	printf desktop" "
	printf desktoppath" "
	printf desktoptheme" "
	printf display" "
	printf emoticons" "
	printf fontinst" "
	printf fonts" "
	printf kde-gtk-config" "
	printf icons" "
	printf mouse" "
	printf screensaver" "
	printf style" "
	printf workspaceoptions
	printf kcm_colord" "
	printf kwincompositing" "
	printf kwindecoration" "
	printf kdm" "
	printf keys" "
	printf kgamma" "
	printf khotkeys" "
	printf kcm_kscreen" "
	printf kcmlaunch" "	
	printf kcm_activities" "
	printf kcm_lightdm" "
	printf kwinoptions" "
	printf kwinrules" "
	printf kwinscreenedges" "
	printf kwinscripts" "
	printf ksplashthememgr" "
	printf kwintabbox" "
}
if (tty -s); then
	kcmshell4 --caption "Graphical Desktop Setup and Behavior Configuration (terminal)" $(kcmopts) $(shellnames) > /tmp/kcmshell4.log 2>&1 & disown %
	if [ $? -ne 0 ] && [ "$kcmdeskset_nodump" != "1" ];  then 
		echo "Error: returned code $?!"	> /dev/stderr
		echo "-- Begin kcmshell Output Dump --"
		[ -r /tmp/kcmshell4.log ] && cat /tmp/kcmshell4.log || echo "(no output recorded)"
		echo "-- End of Output --"
		echo "If kcmshell4 ran ok and you didnt have problems, add the line \"EXPORT kcmdeskset_nodump=1\" to your ~/.bashrc script (or create it) and the dump messages will be ignored."
	else
		true
	fi
else
	if (kcmshell4 $(kcmopts) --caption "Graphical Desktop Setup and Behavior Configuration (direct)" $(shellnames) > /tmp/kcmshell4.log 2>&1); then
		true
	else
		zenity --text-info --filename="/tmp/kcmshell4.log"
	fi
fi
unset shellnames
